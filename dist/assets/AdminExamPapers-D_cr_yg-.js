import{c as F,e as _,r as s,j as e,o as A,A as K,p as Q,F as R,t as r,v as P,C as Y}from"./index-CZZYYvlE.js";import{u as S}from"./useQuery-2_0wHuFf.js";import{u as L}from"./useMutation-DvkIc7Ot.js";import{T as I}from"./trash-2-wP_bCJjQ.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=F("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=F("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function W(){const l=_(),[o,n]=s.useState(!1),[x,m]=s.useState(null),[u,p]=s.useState(null),[i,h]=s.useState(""),[g,C]=s.useState(new Date().getFullYear()),[d,y]=s.useState(""),[f,b]=s.useState(""),[j,N]=s.useState(!1),[w,c]=s.useState(null),{data:q=[]}=S({queryKey:["exam-subjects"],queryFn:r.getSubjects}),{data:v=[]}=S({queryKey:["exam-papers"],queryFn:r.getExamPapers}),E=L({mutationFn:r.deleteExamPaper,onSuccess:()=>{l.invalidateQueries({queryKey:["exam-papers"]})}}),D=async t=>{if(t.preventDefault(),!x||!u||!i||!d){c("Please fill all required fields");return}N(!0),c(null);try{const a=await r.uploadExamPaper(x,u,{subjectId:i,year:g,paperNumber:d,title:f||void 0});l.invalidateQueries({queryKey:["exam-papers"]}),r.extractPDFText(a.id).then(()=>{console.log("PDF extraction started successfully for paper:",a.id),l.invalidateQueries({queryKey:["exam-papers"]})}).catch(k=>{console.error("PDF extraction failed:",k),alert(`Warning: Paper uploaded successfully, but PDF text extraction failed: ${k.message}. You can retry extraction later.`)}),m(null),p(null),h(""),y(""),b(""),n(!1)}catch(a){c(a.message||"Failed to upload exam paper")}finally{N(!1)}},U=async t=>{confirm("Are you sure you want to delete this exam paper?")&&E.mutate(t)},M=async t=>{try{await r.extractPDFText(t),l.invalidateQueries({queryKey:["exam-papers"]}),alert("PDF extraction started. This may take a few moments.")}catch(a){alert(`Failed to start extraction: ${a.message}`)}},T=t=>{switch(t){case"completed":return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Extracted"]});case"processing":return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Processing"]});case"failed":return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Failed"]});default:return e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Pending"]})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Manage Exam Papers"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Upload and manage past exam papers and marking schemes"})]}),e.jsxs("button",{onClick:()=>n(!o),className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Upload Paper"]})]}),o&&e.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload New Exam Paper"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),e.jsxs("select",{value:i,onChange:t=>h(t.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",required:!0,children:[e.jsx("option",{value:"",children:"Select a subject"}),q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year *"}),e.jsx("input",{type:"number",min:"1900",max:"2100",value:g,onChange:t=>C(parseInt(t.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paper Number *"}),e.jsx("input",{type:"text",value:d,onChange:t=>y(t.target.value),placeholder:"e.g., 1, 2, 1A",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title (Optional)"}),e.jsx("input",{type:"text",value:f,onChange:t=>b(t.target.value),placeholder:"e.g., Midterm Exam",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Exam Paper PDF *"}),e.jsx("input",{type:"file",accept:".pdf",onChange:t=>{var a;return m(((a=t.target.files)==null?void 0:a[0])||null)},className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Marking Scheme PDF *"}),e.jsx("input",{type:"file",accept:".pdf",onChange:t=>{var a;return p(((a=t.target.files)==null?void 0:a[0])||null)},className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",required:!0})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 bg-red-50 p-3 rounded-md",children:[e.jsx(K,{className:"h-4 w-4"}),w]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:j,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Uploading...":"Upload Paper"}),e.jsx("button",{type:"button",onClick:()=>n(!1),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]})]}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Year"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paper"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Title"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Extraction Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No exam papers uploaded yet"})]})}):v.map(t=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 text-emerald-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:(a=t.subject)==null?void 0:a.name})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.year}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["Paper ",t.paper_number]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:t.title||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:T(t.text_extraction_status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(t.text_extraction_status==="failed"||t.text_extraction_status==="pending")&&e.jsx("button",{onClick:()=>M(t.id),className:"text-blue-600 hover:text-blue-900",title:"Retry extraction",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(t.id),className:"text-red-600 hover:text-red-900",title:"Delete paper",children:e.jsx(I,{className:"h-4 w-4"})})]})})]},t.id)})})]})})})]})}export{W as AdminExamPapers};
