import{c as h,w as E,v as I,r as l,t as i,j as e,F,M as b}from"./index-avNdi-1I.js";import{u as N}from"./useQuery-DnfSf-I2.js";import{u as q}from"./useMutation-2bzCLzUn.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=h("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=h("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=h("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function D(){var j;const{paperId:r}=E(),v=I(),[u,w]=l.useState(null),[g,m]=l.useState([]),[o,y]=l.useState(""),[M,f]=l.useState(null),{data:t,isLoading:S}=N({queryKey:["exam-paper",r],queryFn:()=>i.getExamPaperById(r),enabled:!!r}),{data:x}=N({queryKey:["chat-session",r],queryFn:()=>i.getChatSession(r),enabled:!!r});l.useEffect(()=>{x&&(f(x.id),m(x.messages||[]))},[x]),l.useEffect(()=>{t&&(i.trackPaperAccess(t.id),i.getPaperFileUrl(t.paper_file_url).then(s=>{s&&w(s)}))},[t]);const c=q({mutationFn:async s=>{const a={id:crypto.randomUUID(),role:"user",content:s,timestamp:new Date().toISOString()};return m(d=>[...d,a]),await i.sendChatMessage({paperId:r,question:s,paperContent:"PDF content would be extracted here",markingSchemeContent:"Marking scheme content would be extracted here"})},onSuccess:s=>{const a=s.message;m(n=>[...n,a]),!M&&r&&i.createChatSession(r).then(n=>{f(n.id)})}}),k=s=>{s.preventDefault(),o.trim()&&!c.isPending&&(c.mutate(o),y(""))},P=s=>{try{return JSON.parse(s)}catch{return null}};return S?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-emerald-600"})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>v("/app/exam-papers"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Back to Papers"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:[(j=t.subject)==null?void 0:j.name," - Paper ",t.paper_number," (",t.year,")"]}),t.title&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.title})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(100vh-250px)]",children:[e.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center",children:[e.jsx(F,{className:"h-5 w-5 text-gray-600 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Exam Paper"})]}),e.jsx("div",{className:"h-full overflow-auto p-4",children:u?e.jsx("iframe",{src:u,className:"w-full h-full border-0",title:"Exam Paper"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-gray-400"})})})]}),e.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center",children:[e.jsx(b,{className:"h-5 w-5 text-gray-600 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900",children:"AI Tutor"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[g.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-sm mb-2",children:"Ask the AI tutor about any question!"}),e.jsx("p",{className:"text-xs text-gray-400",children:'Example: "Explain question 5" or "How do I solve question 3?"'})]}):g.map(s=>{const a=s.role==="assistant"?P(s.content):null;return e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[85%] rounded-lg px-4 py-3 ${s.role==="user"?"bg-emerald-600 text-white":"bg-gray-100 text-gray-900"}`,children:s.role==="user"?e.jsx("p",{className:"text-sm",children:s.content}):a?e.jsxs("div",{className:"space-y-3 text-sm",children:[a.explanation&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Explanation"}),e.jsx("p",{className:"text-gray-700",children:a.explanation})]}),a.examples&&a.examples.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Examples"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-700",children:a.examples.map((n,d)=>e.jsx("li",{children:n},d))})]}),a.howToGetFullMarks&&a.howToGetFullMarks.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"How to Get Full Marks"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-gray-700",children:a.howToGetFullMarks.map((n,d)=>e.jsx("li",{children:n},d))})]}),a.solution&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Solution"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.solution})]})]}):e.jsx("p",{className:"text-sm",children:s.content})})},s.id)}),c.isPending&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 rounded-lg px-4 py-3",children:e.jsx(p,{className:"h-5 w-5 animate-spin text-gray-600"})})})]}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("form",{onSubmit:k,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:s=>y(s.target.value),placeholder:"Ask about a specific question...",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500",disabled:c.isPending}),e.jsx("button",{type:"submit",disabled:!o.trim()||c.isPending,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(C,{className:"h-4 w-4"})})]})})]})]})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:"Exam paper not found"})})}export{D as ExamPaperViewer};
